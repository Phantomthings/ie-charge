<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-value">{{ total }}</div>
        <div class="stat-label">Total charges</div>
    </div>
    <div class="stat-card">
        <div class="stat-value" style="color:#10b981;">{{ ok }}</div>
        <div class="stat-label">R√©ussite</div>
    </div>
    <div class="stat-card">
        <div class="stat-value" style="color:#ef4444;">{{ nok }}</div>
        <div class="stat-label">√âchec</div>
    </div>
    <div class="stat-card">
        <div class="stat-value" style="color:#3b82f6;">{{ taux_reussite }}%</div>
        <div class="stat-label">Taux de r√©ussite</div>
    </div>
    <div class="stat-card">
        <div class="stat-value" style="color:#f59e0b;">{{ taux_echec }}%</div>
        <div class="stat-label">Taux d'√©chec</div>
    </div>
</div>

<div style="display:flex; flex-direction:column; gap:1.25rem;">
    <div style="background:var(--color-surface); border:1px solid var(--color-border); border-radius:var(--radius-sm); padding:1rem;">
        <div style="font-weight:700; margin-bottom:0.75rem; color:var(--color-text);">R√©capitulatif des erreurs par site et moment</div>
        {% if recap_rows %}
        <div style="overflow-x:auto;">
            <table style="width:100%; border-collapse:collapse; min-width:720px;">
                <thead>
                    <tr>
                        {% for col in recap_columns %}
                        <th style="text-align:left; padding:0.5rem; font-size:0.85rem; color:var(--color-text-muted); border-bottom:1px solid var(--color-border); white-space:nowrap;">{{ col }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for row in recap_rows %}
                    <tr>
                        {% for col in recap_columns %}
                        {% set value = row[col] %}
                        <td style="padding:0.5rem; font-size:0.9rem; border-bottom:1px solid var(--color-border); color:var(--color-text);">
                            {% if col in ['% OK', '% NOK'] %}
                                {{ value | round(2) }}%
                            {% else %}
                                {{ value }}
                            {% endif %}
                        </td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-icon">üìä</div>
            <div>Aucune donn√©e r√©capitulative disponible pour ce p√©rim√®tre.</div>
        </div>
        {% endif %}
    </div>

    <div style="background:var(--color-surface); border:1px solid var(--color-border); border-radius:var(--radius-sm); padding:1rem;">
        <div style="font-weight:700; margin-bottom:0.75rem; color:var(--color-text);">R√©partition des erreurs par moment</div>
        {% if moment_distribution %}
        <div class="bar-chart">
            {% for item in moment_distribution %}
            <div class="bar-row">
                <span class="bar-label">{{ item.moment }}</span>
                <div class="bar-container">
                    <div class="bar bar-danger" style="width: {{ item.percent }}%;"></div>
                </div>
                <span class="bar-value text-danger">{{ item.count }}</span>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-icon">‚úÖ</div>
            <div>Aucune erreur sur la p√©riode s√©lectionn√©e.</div>
        </div>
        {% endif %}
    </div>
</div>
